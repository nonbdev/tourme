
<html>
<head>
	<title>Leaflet mobile example</title>

	<link rel="stylesheet" href="css/leaflet.css" />
<meta name="viewport"  content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<script src="js/leaflet.js"></script>
<script>L_DISABLE_3D = true;</script>
	<style>
		body {
			padding: 0;
			margin: 0;
		}
		html, body, #map {
			height: 100%;
		}
		img.leaflet-tile {
		    /* work-around from here: https://github.com/CloudMade/Leaflet/issues/161 */
		    outline: 1px solid transparent;
		}
	</style>
</head>
<body onload="initMap()">
	<div id="map"></div>

	<script>

		TourMe = {};

		function setUrl(url){
			Android.print(url);
			TourMe.url = url;
			TourMe.radious = 500;
		}

		/**
		 * Устанавливает режим работы карты
		 * loadRegion - добавление регионов для загрузки
		 * simple - просто просмотр объектов
		 */
		function setMode(mode){
			TourMe.mode = mode;
		}

		function initMap(){
			
			url = "file:///mnt/sdcard/osmdroid/Mapnik/{z}/{x}/{y}.png"
			//Android.print(url);

			offlineLayer = L.tileLayer(url, {
				maxZoom: 18,
				attribution: 'Map data © OpenStreetMap contributors'
			});

			onlineLayer = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				maxZoom: 18,
				attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
			});

			TourMe.map = L.map('map',{
				center: [61.800322,34.320819],
				zoom: 15,
				layers: [onlineLayer],
				fadeAnimation: false,
				zoomAnimation: false,
				markerZoomAnimation: false
			});

			TourMe.mainMarkers = new L.layerGroup();			
			TourMe.mainMarkers.addTo(TourMe.map);

			TourMe.addMarkersLayer = new L.layerGroup();
			TourMe.addMarkersLayer.addTo(TourMe.map);

			TourMe.map.on('click', function(options){
				var marker = L.marker(options.latlng)/**/;
				var circle = L.circle(options.latlng, 1000, {
					stroke: false,
				});
				TourMe.addMarkersLayer.addLayer(marker);
				TourMe.addMarkersLayer.addLayer(circle);
				//TourMe.map.invalidateSize(false);
			});

			/*var baseLayers = {
				"online": online,
				"offline": offline
			};*/


			//L.control.layers(baseLayers).addTo(TourMe.map);

			addTestMarkers();
		}
		
		function setOnlineLayer(){
			TourMe.map.removeLayer(offlineLayer);
			TourMe.map.removeLayer(onlineLayer);
			TourMe.map.addLayer(onlineLayer);
		}
		function setOfflineLayer(){
			TourMe.map.removeLayer(offlineLayer);
			TourMe.map.removeLayer(onlineLayer);
			TourMe.map.addLayer(offlineLayer);
		}
		function addTestMarkers(){
				//test
			var i = 0;
			for (;i<5;i++){
				addMarker("arch",61.800322,34.320819+i*0.002,"arch");
			}
			i = 0;
			for (;i<5;i++){
				addMarker("palm-tree-export",61.800322+0.001,34.320819+i*0.002,"palm");
			}
			i = 0;
			for (;i<5;i++){
				addMarker("tower",61.800322+0.002,34.320819+i*0.002,"tower");
			}
				i = 0;
			for (;i<5;i++){
				addMarker("information",61.800322+0.003,34.320819+i*0.002,"information");
			}
				i = 0;
			for (;i<5;i++){
				addMarker("bustour",61.800322+0.004,34.320819+i*0.002,"bustour");
			}
		}
		function addMarker(group, lat, lng, description){
			var url = "js/images/markers/"+group+".png";
			var markerIcon = L.icon({
			    iconUrl: url,
			    iconSize:     [32, 37], // size of the icon
			    iconAnchor:   [16, 18], // point of the icon which will correspond to marker's location
			    popupAnchor:  [0, -10] // point from which the popup should open relative to the iconAnchor
			});

			var marker = L.marker([lat, lng], {icon: markerIcon}).bindPopup(description);

			TourMe.mainMarkers.addLayer(marker);
		}

		function print(){
			alrt("str");
		}
		function setZoom(num){
			TourMe.map.setZoom(num);
		}
	</script>
</body>
</html>